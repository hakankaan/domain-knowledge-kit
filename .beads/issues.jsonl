{"id":"domain-knowledge-kit-1rc","title":"Add init and prime CLI commands for agent onboarding","description":"Add two new CLI commands: dkk init (creates/updates AGENTS.md) and dkk prime (outputs full agent context)","status":"closed","priority":2,"issue_type":"epic","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-21T15:17:52Z","created_by":"Kaan Akın","updated_at":"2026-02-21T16:45:10Z","closed_at":"2026-02-21T16:45:10Z","close_reason":"Closed"}
{"id":"domain-knowledge-kit-1rc.1","title":"Implement dkk init command","description":"Create src/features/agent/commands/init.ts. Command creates or updates AGENTS.md at repo root with a DKK section delimited by HTML comment markers. Idempotent merge: replace between markers if found, append if not, create if missing. Concise content pointing to dkk prime.","acceptance_criteria":"Creates AGENTS.md when none exists. Appends DKK section preserving existing content. Idempotent on re-run. Prints created/updated confirmation.","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-21T15:18:03Z","created_by":"Kaan Akın","updated_at":"2026-02-21T16:45:08Z","closed_at":"2026-02-21T16:45:08Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-1rc.1","depends_on_id":"domain-knowledge-kit-1rc","type":"parent-child","created_at":"2026-02-21T18:18:03Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-1rc.2","title":"Implement dkk prime command","description":"Create src/features/agent/commands/prime.ts. Outputs comprehensive DKK usage context to stdout for agent consumption. Hardcoded template: project overview, core principles, domain structure, retrieval workflow, change workflow, ID conventions, CLI reference, file conventions. Uses dkk as CLI name.","acceptance_criteria":"Outputs full agent context to stdout with exit 0. Contains all key sections. Uses dkk as CLI name.","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-21T15:18:09Z","created_by":"Kaan Akın","updated_at":"2026-02-21T16:45:09Z","closed_at":"2026-02-21T16:45:09Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-1rc.2","depends_on_id":"domain-knowledge-kit-1rc","type":"parent-child","created_at":"2026-02-21T18:18:08Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-1rc.3","title":"Wire init and prime into CLI entry point","description":"Import registerInit and registerPrime in src/cli.ts and register as top-level commands.","acceptance_criteria":"dkk --help lists init and prime. Both commands are callable.","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-21T15:18:14Z","created_by":"Kaan Akın","updated_at":"2026-02-21T16:45:09Z","closed_at":"2026-02-21T16:45:09Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-1rc.3","depends_on_id":"domain-knowledge-kit-1rc","type":"parent-child","created_at":"2026-02-21T18:18:13Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-1rc.4","title":"Add integration tests for init and prime","description":"Add test sections in test/cli-integration.ts. Init tests: create new, append existing, idempotent re-run. Prime tests: stdout output, key sections present. Update smoke test to include init and prime in --help output check.","acceptance_criteria":"npm test passes with all new and existing tests green.","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-21T15:18:20Z","created_by":"Kaan Akın","updated_at":"2026-02-21T16:45:09Z","closed_at":"2026-02-21T16:45:09Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-1rc.4","depends_on_id":"domain-knowledge-kit-1rc","type":"parent-child","created_at":"2026-02-21T18:18:20Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-1rc.5","title":"Dogfood: run dkk init on project AGENTS.md","description":"Run dkk init on the project itself. Verify AGENTS.md has the DKK section with markers alongside existing bd/session content.","acceptance_criteria":"AGENTS.md contains both existing content and DKK section with comment markers.","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-21T15:18:26Z","created_by":"Kaan Akın","updated_at":"2026-02-21T16:45:10Z","closed_at":"2026-02-21T16:45:10Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-1rc.5","depends_on_id":"domain-knowledge-kit-1rc","type":"parent-child","created_at":"2026-02-21T18:18:25Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783","title":"DKK Usability Overhaul","description":"Improve DKK usage simplicity without decreasing features. Covers critical bug fixes (path resolution, doc/code format mismatch), workflow streamlining (eliminate double validation, auto-build search index), scaffolding commands (dkk new, dkk add for AI agent consumption), and enriching dkk prime with live domain data. Goal: reduce onboarding from 8+ manual steps to 1 command, and the daily quality gate from 2 commands to 1.","status":"open","priority":1,"issue_type":"epic","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:16:02Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:16:02Z","dependencies":[{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.1","type":"blocks","created_at":"2026-02-22T17:22:55Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.2","type":"blocks","created_at":"2026-02-22T17:22:58Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.3","type":"blocks","created_at":"2026-02-22T17:23:02Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.4","type":"blocks","created_at":"2026-02-22T17:23:06Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.5","type":"blocks","created_at":"2026-02-22T17:23:09Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.6","type":"blocks","created_at":"2026-02-22T17:23:12Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783","depends_on_id":"domain-knowledge-kit-783.7","type":"blocks","created_at":"2026-02-22T17:23:16Z","created_by":"Kaan Akın","metadata":"{}"}],"comments":[{"id":1,"issue_id":"domain-knowledge-kit-783","author":"Kaan Akın","text":"Preflight complete. Epic decomposed into 7 children (783.1-783.7). All children added as blocking deps so epic won't appear in bd ready until all children are closed. Inter-child dep: 783.5 blocks 783.6. Suggested order: 783.1+783.2 (P1 bugs), then 783.3+783.4 (P2 tasks), then 783.5-\u003e783.6 (features), 783.7 (independent P3).\n","created_at":"2026-02-22T14:24:49Z"}]}
{"id":"domain-knowledge-kit-783.1","title":"Fix repoRoot() path resolution for installed packages","description":"src/shared/paths.ts resolves repoRoot() via import.meta.dirname, which points to the DKK package install directory — not the user's project. Every command silently looks for .dkk/domain/ inside node_modules/domain-knowledge-kit/. The --root flag is effectively mandatory but documented as optional.\n\nFix: Split path resolution into two strategies:\n- Domain paths (domainRoot, docsRoot, searchIndexPath) resolve from process.cwd() or --root override\n- Package asset paths (schemaDir, templateDir) resolve from import.meta.dirname relative to the package install\n\nFiles to change:\n- src/shared/paths.ts — add packageRoot() helper, change repoRoot() default to process.cwd()\n- src/features/pipeline/validator.ts — use packageRoot() for schema resolution\n- src/features/pipeline/renderer.ts — use packageRoot() for template resolution\n- src/features/pipeline/indexer.ts — u  --type bug   --priority 1   --parent domain-knowledge-kit-783 r  --priorityUpd  --parent domari  -d src/shared/paths.ts","status":"closed","priority":1,"issue_type":"bug","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:16:20Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:30:33Z","closed_at":"2026-02-22T14:30:33Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-783.1","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:16:20Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783.2","title":"Fix documentation to match per-item directory format","description":"All user-facing docs show a single-file context format (ordering.yml with inline events/commands), but src/shared/loader.ts only supports the per-item directory format (contexts/ordering/context.yml + events/OrderPlaced.yml). Users following the docs get zero contexts loaded silently.\n\nAlso: aggregate docs show flat handles/emits arrays but the actual schema requires nested handles.commands/emits.events format.\n\nFiles to change:\n- README.md — update quick-start YAML examples to directory structure\n- docs/getting-started.md — rewrite steps 1-3 with correct per-item file layout\n- docs/domain-modeling.md — update examples for each item type\n- docs/cli-reference.md — fix any examples using old format\n- src/features/agent/commands/prime.ts — update hardcoded YAML structure reference\n- Fix aggregate examples to show correct nested handles.commands/emits.events for  --type bug   --priority 1   --parent domain-knowledge-kit-78in  --priority ac  --parent doma v  -d All","status":"closed","priority":1,"issue_type":"bug","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:16:33Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:36:31Z","closed_at":"2026-02-22T14:36:31Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-783.2","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:16:33Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783.3","title":"Streamline quality gate — eliminate double validation","description":"Docs and AGENTS.md instruct users to run 'dkk validate' then 'dkk render'. But render.ts already calls validateDomainModel() internally (unless --skip-validation). Every domain change triggers validation twice.\n\nFix: Update all documentation to recommend just 'dkk render' as the single quality gate command. Keep 'dkk validate' available as a standalone dry-run check (useful for CI or quick validation without render), but position it as optional/lightweight.\n\nFiles to change:\n- AGENTS.md — quality gates section: recommend just dkk render\n- docs/getting-started.md — update quality gate instructions\n- docs/domain-modeling.md — update quality gate references\n- src/features/agent/commands/prime.ts — update hardcoded quality gate instructions\n- src/features/agent/commands/init.ts — update AGENTS.md template quality gate section\n- .github/copilot-instructions.m  --type task   --priority 2   --parent domain-knowledge-kit-783 is  --priority 2nd  --parent domas   -d Docs","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:16:50Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:39:30Z","closed_at":"2026-02-22T14:39:30Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-783.3","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:16:50Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783.4","title":"Auto-build search index on dkk search","description":"dkk search fails with \"Search index not found. Run render first.\" when no index exists. Users must know to run render before searching - a hidden prerequisite.\n\nFix: When the search index is not found, automatically build it by calling the indexer before executing the search.\n\nFiles to change:\n- src/features/query/commands/search.ts - catch missing index, call buildSearchIndex() as fallback\n- src/features/pipeline/indexer.ts - ensure buildSearchIndex can be imported and called standalone\n- Add a --no-auto-index flag for fail-fast behavior\n- Add test case for the auto-build path\n\nImplementation:\n1. Import buildSearchIndex from indexer.ts\n2. In the search command, wrap the searcher call to catch the \"not found\" error\n3. When caught, print \"Search index not found - building... done.\" and retry\n4. Add --no-auto-index flag to preserve old behavior for scripts that want explicit control\n","acceptance_criteria":"Running dkk search on a project with valid domain YAML but no prior render succeeds after auto-building the index. A brief message informs the user the index was built.","notes":"Implementation was already in search.ts (auto-build + --no-auto-index flag). Updated E2E tests in test/cli-integration.ts: (1) replaced old 'search fails when no index' test with 'search auto-builds index when missing' — asserts exit 0, finds results, prints building message to stderr; (2) added '--no-auto-index fails on missing index' test — asserts exit 1 and error message; (3) fixed run() helper to use spawnSync so stderr is captured on success. All 121 E2E tests pass, typecheck/lint/build clean.","status":"closed","priority":2,"issue_type":"task","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:17:29Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:48:17Z","closed_at":"2026-02-22T14:48:17Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-783.4","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:17:28Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783.5","title":"Add dkk new scaffolding command","description":"Setting up a domain model requires 8+ manual steps: create directories, write index.yml, actors.yml, context.yml, item files, etc. No guidance, no templates, easy to get the structure wrong.\n\nFix: Add scaffolding subcommands under \"dkk new\":\n\n- dkk new domain - creates full .dkk/domain/ structure: index.yml, actors.yml, contexts/ directory, and one example context with a sample event, command, and aggregate\n- dkk new context \u003cname\u003e - creates contexts/\u003cname\u003e/context.yml + type subdirectories (events/, commands/, aggregates/, policies/, read-models/, glossary/) and registers the context in index.yml\n- dkk new adr \u003ctitle\u003e - creates next .dkk/adr/adr-NNNN.md with frontmatter template\n\nAll subcommands use flags (not interactive prompts) for AI agent compatibility:\n- dkk new context ordering --description \"Order lifecycle\"\n- dkk new adr \"Adopt Event Sourcing\" --status accepted\n\nFiles to create/change:\n- src/features/scaffold/commands/new.ts - new command module\n- src/features/scaffold/templates/ - YAML template strings (or inline them)\n- src/cli.ts - register new commands\n- Add integration tests\n","acceptance_criteria":"dkk new domain \u0026\u0026 dkk render succeeds from an empty project. AI agents can run dkk new context \u003cname\u003e --description '...' without interactive prompts.","status":"closed","priority":2,"issue_type":"feature","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:18:08Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:55:05Z","closed_at":"2026-02-22T14:55:05Z","close_reason":"Closed","dependencies":[{"issue_id":"domain-knowledge-kit-783.5","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:18:07Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783.6","title":"Add dkk add item scaffolding command","description":"Adding individual domain items (events, commands, aggregates, policies, read-models, glossary entries) requires knowing the exact directory structure and YAML schema. Agents and users must create files manually.\n\nDepends on: Ticket 5 (dkk new scaffolding) for shared scaffold infrastructure.\n\nFix: Add \"dkk add\" subcommands for each item type:\n- dkk add event \u003ccontext\u003e \u003cname\u003e [--description \"...\"] [--raised-by \u003caggregate\u003e] [--triggers \u003cpolicy1,policy2\u003e]\n- dkk add command \u003ccontext\u003e \u003cname\u003e [--description \"...\"] [--handled-by \u003caggregate\u003e]\n- dkk add aggregate \u003ccontext\u003e \u003cname\u003e [--description \"...\"] [--handles \u003ccmd1,cmd2\u003e] [--emits \u003cevt1,evt2\u003e]\n- dkk add policy \u003ccontext\u003e \u003cname\u003e [--description \"...\"] [--triggered-by \u003cevent\u003e] [--emits-command \u003ccmd\u003e]\n- dkk add read-model \u003ccontext\u003e \u003cname\u003e [--description \"...\"] [--updated-by \u003cevt1,evt2\u003e]\n- dkk add glossary \u003ccontext\u003e \u003cterm\u003e [--definition \"...\"]\n- dkk add actor \u003cname\u003e [--description \"...\"] (appends to actors.yml)\n\nDesign:\n- Each creates the correctly-structured YAML file in the right directory\n- Validates the target context exists; errors clearly if not\n- All flags are optional - creates minimal valid YAML with just the name if no flags provided\n- Flag-based interface optimized for AI agent consumption\n\nFiles to create/change:\n- src/features/scaffold/commands/add.ts - new command module\n- src/cli.ts - register add commands\n- Add unit and integration tests\n","acceptance_criteria":"dkk add event ordering OrderPlaced --description 'Raised when order is placed' --raised-by Order creates a valid YAML file that passes dkk validate.","status":"open","priority":3,"issue_type":"feature","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:18:13Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:18:13Z","dependencies":[{"issue_id":"domain-knowledge-kit-783.6","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:18:13Z","created_by":"Kaan Akın","metadata":"{}"},{"issue_id":"domain-knowledge-kit-783.6","depends_on_id":"domain-knowledge-kit-783.5","type":"blocks","created_at":"2026-02-22T17:18:29Z","created_by":"Kaan Akın","metadata":"{}"}]}
{"id":"domain-knowledge-kit-783.7","title":"Enrich dkk prime with live domain summary","description":"dkk prime outputs a hardcoded generic instruction document. Agents get a user manual but zero project-specific domain knowledge. They must then run dkk list, dkk show, etc. separately to learn the actual domain model.\n\nFix: After the static instructions, dynamically append a \"Current Domain Summary\" section:\n- Load the domain model via loader.ts\n- Count and list contexts with their descriptions\n- Count items per type (events, commands, aggregates, policies, read-models, glossary)\n- List actors\n- List ADRs with titles and statuses\n- Show key relationships (aggregates and their handled commands, emitted events)\n\nUse item-visitor.ts to iterate items efficiently.\n\nGraceful degradation: if no domain model exists or loading fails, output just the static instructions with a note: \"No domain model found. Run dkk new domain to get started.\"\n\nAdd --static-only flag for cases where only the generic instructions are wanted.\n\nFiles to change:\n- src/features/agent/commands/prime.ts - add dynamic domain summary generation\n- src/shared/loader.ts - ensure loadAllContexts can be called from prime without side effects\n- src/shared/item-visitor.ts - may need summary-oriented visitor helpers\n- Add tests for dynamic summary generation\n","acceptance_criteria":"Running dkk prime on a project with a domain model outputs both the instruction manual AND a summary showing contexts, item counts, actors, and ADRs. On an empty project, it outputs instructions plus a helpful no-domain-found note.","status":"open","priority":3,"issue_type":"feature","owner":"kaanhakan2005@gmail.com","created_at":"2026-02-22T14:18:19Z","created_by":"Kaan Akın","updated_at":"2026-02-22T14:18:19Z","dependencies":[{"issue_id":"domain-knowledge-kit-783.7","depends_on_id":"domain-knowledge-kit-783","type":"parent-child","created_at":"2026-02-22T17:18:18Z","created_by":"Kaan Akın","metadata":"{}"}]}
